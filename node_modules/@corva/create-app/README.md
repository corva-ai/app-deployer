# @corva/create-app

Apps generator for [corva.ai](https://corva.ai).

## Prerequisites

- NodeJs >= 16.14.0 (https://nodejs.org/en/download/)

## Installation

```sh
npm i -g @corva/create-app
```

## Usage

`corva-create-app` provides a user-friendly CLI wizard to create an app.

```sh
Usage: create-corva-app [options] [command]

Options:
  -h, --help                                           display help for command

Commands:
  create [options] [project-directory]                 Create a new app
  zip [options] <project-directory> [patterns...]      Bundle app
  release [options] <project-directory> [patterns...]  Release app
  rerun [options] <project-directory>                  Rerun app
  attach [options] <project-directory>                 Add app to live assets streams
  help [command]                                       display help for command
```

## Create an app

To create a new app use `create` command.

```sh
Usage: create-corva-app create <project-directory> [options]

Create a new app

Arguments:
  project-directory               project directory to work with (default: "Current working dir")

Options:
  --appKey [string]               Enter the App Key (default: "app.key-goes-here")
  --appName [string]              Enter the App Name
  --appType [string]              Choose the App Type (choices: "ui", "scheduler", "stream", "task", default: "ui")
  --category [string]             Enter category (default: "")
  --cronString [string]           Provide CRON string for the scheduler (default: "*/5 * * * *")
  --depthMilestone [number]       Provide depth milestone for the scheduler (default: 1)
  --description [string]          Enter description (default: "This is the description of my app. You can do great things with it!")
  --developerIdentifier [string]  Enter the Developer Identifier (default: "oandgc")
  --developerName [string]        Enter the Developer Name (default: "O&G Company")
  --runtime [string]              Choose runtime (choices: "ui", "nodejs16.x", "python3.8", "python3.9")
  --schedulerType [number]        Choose the scheduler type (choices: "1", "2", "4", default: 1)
  --segments [string]             Choose segments (choices: "drilling", "completion")
  --summary [string]              Enter summary (default: "More information about this app goes here")
  --website [string]              Enter website (default: "https://www.oandgexample.com/my-app/")
  -p, --packageManager [string]   Please select the desired package manager (choices: "yarn", "npm", default: "yarn")
  -t, --useTypescript [boolean]   Would you like to use TypesScript? (default: false)
  --silent [boolean]              Only log result of the operation (default: false)
```

### Examples

#### Create a UI application

```sh
create-corva-app test --appName "Test" --segments "drilling" --category "wellDesign" --appKey "some-company.test.ui" --appType "ui" --runtime "ui"
```

#### Create a NodeJs TypeScript application

```sh
create-corva-app test --appName "Test" --segments "drilling" --category "wellDesign" --appKey "some-company.test.scheduler" --appType "scheduler" --runtime "nodejs12.x" -t
```

#### Create a Python application

```sh
create-corva-app test --appName "Test" --segments "drilling" --category "analytics" --appKey "some-company.test.stream" --appType "stream" --runtime "python3.8"
```

## Zip

To create a zip that contains app ready to be deployed to Corva use `zip` command.

```sh
Usage: create-corva-app zip [options] <project-directory> [patterns...]

Bundle app

Arguments:
  project-directory                  Project directory to work with
  patterns                           Additional patterns to zip (default: [])

Options:
  --bump-version <string>            Bump version (choices: "major", "minor", "patch", "skip")
  --ignored-files [ignoredFiles...]  Patterns to skip zip
  --silent [boolean]                 Only log result of the operation (default: false)
```

### What is getting zipped?

By default next files will be included.

For `frontend` apps:

- `manifest.json`
- `package.json`
- `yarn.lock`
- `.npmrc`
- `config-overrides.js`
- all files under `src`
- `tsconfig.json`

For apps that written in `node`:

- `manifest.json`
- `package.json`
- either `package-lock.json` or `yarn.lock`
- all files under `config` folder
- all `*.js` files under `src` and `lib` folders (if `typescript` is not used)
- `tsconfig.json`, `tsconfig.build.json` (if `typescript` is used)
- all `*.ts` files under `src` and `lib` folders (if `typescript` is used)

For apps that written in `python`:

- `manifest.json`
- `requirements.txt`
- all `*.py` files

If you want to zip some files that are not included pass that as `patterns` arguments.
To skip some files from zipping please use `--ignored-files` option.

### Examples

#### Create a zip file from the content of `test-app` folder & put zip file in it.

```sh
create-corva-app zip test-app
```

#### Create a zip file & automatically bump version

```sh
create-corva-app zip test-app --bump-version=patch
```

#### Create a zip file from the content of `test-app` folder with custom content ([globs](<https://en.wikipedia.org/wiki/Glob_(programming)>) are supported)

```sh
create-corva-app zip test-app some/missing/file1 some/other/missing/file2 all/files/*.glob
```

## Release

To push app to Corva use `release` command.

```sh
Usage: create-corva-app release [options] <project-directory> [patterns...]

Release app

Arguments:
  project-directory            Project directory to work with
  patterns                     Additional patterns to zip (default: [])

Options:
  --bump-version <string>      Bump version (choices: "major", "minor", "patch", "skip")
  --ignored-files [string...]  Patterns to skip zip (default: [])
  --env [string]               Environment to use (choices: "qa", "staging", "production", default: "qa")
  --api-key [string]           Pre generated API key for authorization during app upload
  --notes [string]             Add custom notes to published app
  --label [string]             Put a label on the release (choices: "BETA", "STABLE")
  --remove-on-fail [boolean]   Remove release if it fails during deployment (default: false)
  --silent [boolean]           Only log result of the operation (default: false)
  --remove-on-success          App package (.zip) will not be deleted after upload (default: true)
```

### Examples

#### Make a release with ask for version

```sh
create-corva-app release test-app
```

#### Make a release without version increase

```sh
create-corva-app release test-app --bump-version=skip
```

#### Make a release with increased version

```sh
create-corva-app release test-app --bump-version=patch
```

#### Make a release with custom version

```sh
create-corva-app release test-app --bump-version=4.2.0
```
