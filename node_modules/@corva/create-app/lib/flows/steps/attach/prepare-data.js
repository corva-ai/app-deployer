import { StepError } from '../../lib/step-error.js';

export const PREPARE_DATA_TASK_STEP = {
  message: 'Preparing and checking data...',
  fn: async (context) => {
    const { manifest, api } = context;

    if (!['scheduler', 'stream'].includes(manifest.manifest.application.type)) {
      throw new StepError('Command supports only "scheduler" or "stream" apps');
    }

    const app = await api.getAppByKey(manifest.manifest.application.key.toLowerCase());

    return {
      app,
      ...context,
    };
  },
};
