export const ADD_APP_TO_STREAM_TASK_STEP = {
  message: 'Add app to streams...',
  fn: async (context) => {
    const { assetsStreamsDataToProcess, api, app, manifest, notification } = context;

    let counter = 0;

    for (const assetStreamsData of assetsStreamsDataToProcess) {
      for (const stream of assetStreamsData.selectedStreams) {
        notification.printStreamLink(stream.name, stream.id);

        try {
          await api.connectAppToStream(app.id, stream.id, manifest.manifest.settings.app);
          ++counter;
        } catch (e) {
          notification.printError(`Could not add app to the stream, an error occurred: ${e.message}`);
        }
      }
    }

    notification.print(`The app has been added to ${counter} - stream(s)`);
  },
};
