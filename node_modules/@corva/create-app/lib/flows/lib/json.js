import { promises as fs } from 'node:fs';
import os from 'node:os';
import { resolve } from 'node:path';

import debugFn from 'debug';

const debug = debugFn('cca:json');

export const loadJson = async (dirName, fileName) => {
  const fullPath = resolve(dirName, fileName);

  try {
    debug('Loading file %s', fullPath);

    const manifest = await fs.readFile(fullPath, 'utf8');

    return JSON.parse(manifest);
  } catch (e) {
    if (e.code === 'ENOENT') {
      throw new Error(`${fileName} was not found in ${resolve(dirName)}`);
    }

    throw e;
  }
};

export const saveJson = async (dirName, fileName, data) => {
  return fs.writeFile(resolve(dirName, fileName), JSON.stringify(data, null, 2) + os.EOL);
};
