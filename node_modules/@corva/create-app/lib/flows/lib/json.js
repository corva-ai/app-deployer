const { resolve } = require('path');
const { promises: fs } = require('fs');
const os = require('os');

const debug = require('debug')('cca:json');

const loadJson = async (dirName, fileName) => {
  const fullPath = resolve(dirName, fileName);

  try {
    debug('Loading file %s', fullPath);
    const manifest = await fs.readFile(fullPath, 'utf8');

    return JSON.parse(manifest);
  } catch (e) {
    if (e.code === 'ENOENT') {
      throw new Error(`${fileName} was not found in ${resolve(dirName)}`);
    }

    throw e;
  }
};

const saveJson = async (dirName, fileName, data) => {
  return fs.writeFile(resolve(dirName, fileName), JSON.stringify(data, null, 2) + os.EOL);
};

module.exports = { loadJson, saveJson };
