const { Option, InvalidArgumentError } = require('commander');
const chalk = require('chalk');

const flags = '--bump-version <string>';
const description = 'Bump version';
const choices = ['major', 'minor', 'patch', 'skip'];

function argParser(value, previous) {
  if (this.argChoices.includes(value) || semver.valid(value)) {
    return value;
  }

  throw new InvalidArgumentError(
    `Allowed choices are ${this.argChoices
      .map((choice) => `"${choice}"`)
      .join(', ')} or a valid semver version.`
  );
}
const bumpVersionOption = new Option(flags, description).choices(choices).argParser(argParser);

const bumpVersionOptionDeprecated = new Option(
  flags,
  chalk.bgYellow`DEPRECATED` +
    ` Use with ${chalk.cyan`zip`} or ${chalk.cyan`release`} command instead`
)
  .choices(choices)
  .argParser(argParser);

module.exports = { bumpVersionOption, bumpVersionOptionDeprecated };
