#!/usr/bin/env node

const { sync: spawnSync } = require('cross-spawn');
const { resolve } = require('path');

const cmd = 'node';
const originalCwd = process.cwd();

process.chdir(__dirname);

const preparedOriginalArgs = process.argv
  .slice(2)
  // after changing the cwd need to pass the original path
  .concat(['--original-cwd', originalCwd])
  // leave spaces in place for arguments
  .map(a => (a.includes(' ') ? `"${a}"` : a));

const args = ['--no-warnings', '--experimental-json-modules', 'cca.js'].concat(preparedOriginalArgs);

const { signal, status, error } = spawnSync(cmd, args, {
  stdio: 'inherit',
  shell: true,
});

if (signal) {
  process.exit(signal);
}

if (status || error) {
  process.exit(1);
}
